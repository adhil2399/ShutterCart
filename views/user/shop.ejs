 
     <%- include('../partials/user/header') %>
     

     <style>
        .modal-dialog-left {
            position: fixed;
            margin: auto;
            width: 320px;
            height: 100%;
            transform: translateX(-100%);
            transition: transform 0.3s ease-out;
        }
        .modal.fade.show .modal-dialog-left {
            transform: translateX(0);
        }
        .modal-content {
            height: 100%;
            overflow-y: auto;
        }
        body.modal-open .blur-background {
            filter: blur(5px);
            transition: filter 0.3s ease-out;
        }
        .wishlist-icon .iconsax[data-icon="heart"] {
    transition: color 0.3s ease;
}

.text-danger {
    color: #dc3545 !important;
}
    </style>
    <section class="section-b-space pt-0"> 
      <div class="heading-banner">
        <div class="custom-container container">
          <div class="row align-items-center">
            <div class="col-sm-6">
              <h4>Shop</h4>
            </div>
            <div class="col-sm-6">
              <ul class="breadcrumb float-end">
                <li class="breadcrumb-item"> <a class="text-decoration-none text-black " href="/">Home </a></li>
                <li class="breadcrumb-item active"> <a  class="text-decoration-none text-black " href="#">shop </a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="section-b-space pt-0"> 
      <div class="custom-container container">
        <div class="row"> 
          <div class="col-12">
   <!-- Button to trigger modal -->
   <button type="button" class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#filterModal">
    Filter Products
</button>

<a href="/shop" class="btn btn-dark">Clear search & filter</a>
 
<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-left">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="filterModalLabel">Filter Products</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="filterForm" action="/shop" method="GET">
              <!-- Category Filter -->
                  <div class="mb-3">
                      <label class="form-label">Category</label>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="category" value="camara" id="categoryCamara">
                          <label class="form-check-label" for="categoryCamara">Camara</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="category" value="lens" id="categoryLens">
                          <label class="form-check-label" for="categoryLens">Lens</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="category" value="drone" id="categoryDrone">
                          <label class="form-check-label" for="categoryDrone">Drone</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="category" value="mic" id="categoryMic">
                          <label class="form-check-label" for="categoryMic">Mic</label>
                      </div>
                  </div>

                  <!-- Brand Filter -->
                  <div class="mb-3">
                      <label class="form-label">Brand</label>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="brand" value="sony" id="brandSony">
                          <label class="form-check-label" for="brandSony">Sony</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="brand" value="canon" id="brandCanon">
                          <label class="form-check-label" for="brandCanon">Canon</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="brand" value="nikon" id="brandNikon">
                          <label class="form-check-label" for="brandNikon">Nikon</label>
                      </div>
                  </div>

                  <!-- Price Range Filter -->
                  <div class="mb-3">
                      <label class="form-label">Price Range</label>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="price" value="0-10000" id="price1">
                          <label class="form-check-label" for="price1">₹0 - ₹10,000</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="price" value="10001-50000" id="price2">
                          <label class="form-check-label" for="price2">₹10,001 - ₹50,000</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="price" value="50001-100000" id="price3">
                          <label class="form-check-label" for="price3">₹50,001 - ₹1,00,000</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="price" value="100001" id="price4">
                          <label class="form-check-label" for="price4">₹1,00,001 & Above</label>
                      </div>
                  </div>

                  <!-- Availability Filter -->
                  <div class="mb-3">
                      <label class="form-label">Availability</label>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="availability" value="inStock" id="availabilityInStock">
                          <label class="form-check-label" for="availabilityInStock">In Stock</label>
                      </div>
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" name="availability" value="outOfStock" id="availabilityOutOfStock">
                          <label class="form-check-label" for="availabilityOutOfStock">Out of Stock</label>
                      </div>
                  </div>

                  <!-- Submit Button -->
                  <button type="submit" class="btn btn-dark w-100">Apply Filters</button>
              </form>
          </div>
      </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Add blur effect when modal is shown
const filterModal = document.getElementById('filterModal');
filterModal.addEventListener('show.bs.modal', function () {
    document.body.classList.add('modal-open');
});
filterModal.addEventListener('hidden.bs.modal', function () {
    document.body.classList.remove('modal-open');
});
</script>
<div class="top-filter-menu">
  

   <div class="container py-3">
    <form class="d-flex" id="searchForm">
        <input 
            class="form-control me-2" 
            type="search" 
            name="query" 
            id="searchInput"
            placeholder="Search for products..." 
            aria-label="Search" 
            required
        >
        <button class="btn btn-dark" type="submit">
            <i class="bi bi-search"></i>
        </button>
    </form>
  </div>
  
  <script>
  document.getElementById('searchForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      
      const searchQuery = document.getElementById('searchInput').value.trim();
      if (!searchQuery) return;
  
      try {
          // Update URL to reflect search
          const url = new URL(window.location.href);
          url.searchParams.set('query', searchQuery);
          window.history.pushState({}, '', url);
  
          // Fetch search results
          const response = await fetch(`/shop/search?query=${encodeURIComponent(searchQuery)}`);
          
          if (!response.ok) {
              throw new Error('Search failed');
          }
  
          const data = await response.json();
          const productList = document.getElementById('product-list');
          
          // Clear current products
          productList.innerHTML = '';
  
          if (data.products && data.products.length > 0) {
              // Render products
              data.products.forEach(product => {
                  const productHTML =  `
                      <div class="product-box-3 shadow-lg bg-body rounded">
                          <div class="img-wrapper shadow-lg bg-body rounded-top">
                              <div class="label-block">
                                  <a class="label-2 wishlist-icon" href="javascript:void(0)" tabindex="0">
                                      <i class="iconsax" data-icon="heart" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Add to Wishlist"></i>
                                  </a>
                              </div>
                              <div class="product-image">
                                  <a class="pro-first" href="/productDetails?id=${product._id}">
                                      <img class="bg-img" src="${product.productImage[0]}" alt="product">
                                  </a>
                                  <a class="pro-sec" href="/productDetails?id=${product._id}">
                                      <img class="bg-img" src="${product.productImage[1]}" alt="product">
                                  </a>
                              </div>
                              <div class="cart-info-icon">
                                  <a href="" onclick="addToCart('${product._id}')" data-bs-toggle="modal" data-bs-target="#addtocart" tabindex="0">
                                      <i class="iconsax" data-icon="basket-2" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Add to Cart"></i>
                                  </a>
                                  <a href="compare.html" tabindex="0">
                                      <i class="iconsax" data-icon="arrow-up-down" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Compare"></i>
                                  </a>
                                  <a href="#" data-bs-toggle="modal" data-bs-target="#quick-view" tabindex="0">
                                      <i class="iconsax" data-icon="eye" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Quick View"></i>
                                  </a>
                              </div>
                          </div>
                          <div class="product-detail">
                              <a class="text-decoration-none" href="/productDetails?id=${product._id}">
                                  <h6 class="ms-3">${product.productName}</h6>
                              </a>
                              <div class="rating ms-3">★★★★☆</div>
                              <p class="list-per">${product.description}</p>
                              <p class="ms-3 mb-3">$${product.salePrice}
                                  <del>$${product.regularPrice}</del>
                                  `



                  productList.insertAdjacentHTML('beforeend', productHTML);
              });
          } else {
              // Show no results message
              productList.innerHTML = `
                  <div class="col-12 text-center py-5">
                      <h3>No products found</h3>
                      <p>Try different search terms or browse our categories</p>
                  </div>
              `;
          }
      } catch (error) {
          console.error('Search error:', error);
          // Show error message to user
          Toastify({
              text: "Error searching products. Please try again.",
              duration: 3000,
              close: true,
              gravity: "top",
              position: "right",
              backgroundColor: "#dc3545",
              stopOnFocus: true
          }).showToast();
      }
  });
  </script>

                  <form id="sort-form" action="">
                <div class="category-dropdown">
                  <label for="cars">Sort By :</label>
                  <select class="form-select" name="sort" id="sort" onchange=" return onSortChange()">
                    <option value="default">Default</option>
                    <option value="az">name: A-Z</option>
                    <option value="za">Name: Z-A</option>
                    <option value="priceHigh">Price : High - low </option>
                    <option value="priceLow">Price: low - High</option>
                  </select>
                </div>
              </form>
              </div>
              
            </div>
            <div class="product-tab-content ratio1_3" >
              <div class="row-cols-lg-4 row-cols-md-3 row-cols-2 grid-section view-option row g-3 g-xl-4"id="product-list">
              
                
                  <% products.forEach(( element)=>{ %>
                       <div class="product-box-3 shadow-lg bg-body rounded">
                          <div class="img-wrapper shadow-lg bg-body rounded-top">
                              <div class="label-block">
                                <a class="label-2 wishlist-icon <%= wishlistProductIds.includes(element._id.toString()) ? 'in-wishlist' : '' %>" 
                                  href="javascript:void(0)" 
                                  onclick="toggleWishlist('<%=element._id %>')" 
                                  data-product-id="<%=element._id %>"
                                  tabindex="0">
                                   <i class="iconsax <%= wishlistProductIds.includes(element._id.toString()) ? 'text-danger' : '' %>" 
                                      data-icon="heart" 
                                      aria-hidden="true" 
                                      data-bs-toggle="tooltip" 
                                      data-bs-title="Add to Wishlist"></i>
                               </a>
                              </div>
                              <div class="product-image">
                                  <a class="pro-first" href="/productDetails?id=<%= element._id %>">
                                      <img class="bg-img" src="<%= element.productImage[0] %>" alt="product">
                                  </a>
                                  <a class="pro-sec" href="/productDetails?id=<%= element._id %>">
                                      <img class="bg-img" src="<%= element.productImage[1] %>" alt="product">
                                  </a>
                              </div>
                              <div class="cart-info-icon">
                                  <a href="" onclick="addToCart('<%=element._id %>')" data-bs-toggle="modal" data-bs-target="#addtocart" tabindex="0">
                                      <i class="iconsax" data-icon="basket-2" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Add to Cart"></i>
                                  </a>
                                  <a href="compare.html" tabindex="0">
                                      <i class="iconsax" data-icon="arrow-up-down" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Compare"></i>
                                  </a>
                                  <a href="#" data-bs-toggle="modal" data-bs-target="#quick-view" tabindex="0">
                                      <i class="iconsax" data-icon="eye" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Quick View"></i>
                                  </a>
                              </div>
                          </div>
                          <div class="product-detail">
                              <a class="text-decoration-none" href="/productDetails?id=<%= element._id %>">
                                  <h6 class="ms-3"><%= element.productName %></h6>
                              </a>
                              <div class="rating ms-3">★★★★☆</div>
                              <p class="list-per"><%= element.description %></p>
                               <% if (element.quantity < 1) { %>
                                  <span>
                                      <p class="text-danger">Stock Out</p>
                                  </span>
                              <% } else { %>
                                  <p class="ms-3 mb-3">$<%= element.salePrice %>
                                      <del>$<%= element.regularPrice %></del>
                                      <% if (element.productOffer === 0 && element.categoryOffer === 0) { %>
                                        <span>0%</span>
                                      <% }else{ %>
                                      <span><%= element.productOffer||element.categoryOffer %> %</span>
                                      <% } %>
                                  </p>
                              <% } %>
                              <div class="listing-button">
                                  <a class="btn" href="cart.html">Quick Shop</a>
                              </div>
                          </div>
                      </div>
                   
                    <% }) %>

               
              </div>
            </div>

            <div class="pagination-wrap">
              <ul class="pagination">
                  <!-- Previous Page Link -->
                  <% if (pagination.prevPage) { %>
                  <li>
                      <a class="prev text-decoration-none" href="?page=<%= pagination.prevPage %>">
                          <i class="iconsax" data-icon="chevron-left"></i>
                      </a>
                  </li>
                  <% } %>
          
                  <!-- Page Numbers -->
                  <% pagination.pages.forEach(page => { %>
                  <li>
                      <a href="?page=<%= page.number %>" class=" text-decoration-none text-black <%= page.isActive ? 'active' : '' %>">
                          <%= page.number %>
                      </a>
                  </li>
                  <% }) %>
          
                  <!-- Next Page Link -->
                  <% if (pagination.nextPage) { %>
                  <li>
                      <a class="next" href="?page=<%= pagination.nextPage %>">
                          <i class="iconsax" data-icon="chevron-right"></i>
                      </a>
                  </li>
                  <% } %>
              </ul>
          </div>
          
      
           </div>
        </div>
      </div>
    </section>
   
 <%- include('../partials/user/footer') %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


    <script>
      function onSortChange() {
          const sortValue = document.getElementById('sort').value;
           console.log(sortValue)
               const url = new URL(window.location.href);
    url.searchParams.set('sort', sortValue);
    window.history.pushState({}, '', url);
          fetch(`/products?sort=${sortValue}`)
              .then(response => response.json())
              .then(products => {
                  const productList = document.getElementById('product-list');
      

                  console.log('3werstttttttttttt',productList)
                  if (!productList) {
                      alert('Error: Element with ID "product-list" not found.');
                      return;
                  }
      
                  // Clear current products
                  productList.innerHTML = '';
      
                  // Re-render products
                  products.forEach( element => { 
                      const productHTML = `
                          <div>
      <div class="product-box-3 shadow-lg bg-body rounded">
        <div class="img-wrapper shadow-lg bg-body rounded-top">
          <div class="label-block">
            <a class="label-2 wishlist-icon" href="javascript:void(0)" tabindex="0">
              <i class="iconsax" data-icon="heart" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Add to Wishlist"></i>
            </a>
          </div>
          <div class="product-image">
            <a class="pro-first" href="/productDetails?id=${element._id}">
              <img class="bg-img" src="${element.productImage[0]}" alt="product">
            </a>
            <a class="pro-sec" href="/productDetails?id=${element._id}">
              <img class="bg-img" src="${element.productImage[1]}" alt="product">
            </a>
          </div>
          <div class="cart-info-icon">
            <a href="" onclick="addToCart('${element._id}')" data-bs-toggle="modal" data-bs-target="#addtocart" tabindex="0">
              <i class="iconsax" data-icon="basket-2" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Add to cart"> </i>
            </a>
            <a href="compare.html" tabindex="0">
              <i class="iconsax" data-icon="arrow-up-down" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Compare"></i>
            </a>
            <a href="#" data-bs-toggle="modal" data-bs-target="#quick-view" tabindex="0">
              <i class="iconsax" data-icon="eye" aria-hidden="true" data-bs-toggle="tooltip" data-bs-title="Quick View"></i>
            </a>
          </div>
        </div>
        <div class="product-detail">
          <a class="text-decoration-none" href="/productDetails?id=${element._id}">
            <h6 class="ms-3">${element.productName}</h6>
          </a>
          <div class="rating ms-3">★★★★☆</div>
          <p class="list-per">${element.description}</p>
          <p class="ms-3 mb-3">
            $${element.salePrice}
            <del>$${element.regularPrice}</del>
<span>${element.productOffer === 0 ? '0%' : `${element.productOffer}%`}</span>
          </p>
          <div class="listing-button">
            <a class="btn" href="cart.html">Quick Shop</a>
          </div>
        </div>
      </div>
    </div>
                      `;
                      productList.insertAdjacentHTML('beforeend', productHTML);
                  });
              })
              .catch(error => console.error('Error fetching products:', error));
      }
    
      </script>
      
      <script>
        
  async function addToCart(productId) {
    const quantity= 1
    try {
       const response = await fetch('/cart/add',{
        method:'POST',
        headers:{
          'Content-Type': 'application/json'
        },body:JSON.stringify({productId,quantity})

      })
      const data = await response.json()
      if(response.ok){
       Toastify({
                text: "Product added to cart successfully!",
                duration: 3000,
                close: true,
                gravity: "top", // `top` or `bottom`
                position: "right", // `left`, `center` or `right`
                backgroundColor: "#28a745", // Success color (green)
                stopOnFocus: true, // Prevents dismissing on hover
            }).showToast();
        } else {
            Toastify({
                text: data.message || "Error adding to cart",
                duration: 3000,
                close: true,
                gravity: "top",
                position: "right",
                backgroundColor: "#dc3545", // Error color (red)
                stopOnFocus: true,
                 style: {
                  color: "#ffffff", // Text color
                fontSize: "16px", // Optional: Adjust font size
                },
            }).showToast();
        }
    } catch (error) {
        console.error("Error:", error.message);
        Toastify({
            text:  "Something went wrong. Please try again.",
            duration: 3000,
            close: true,
            gravity: "top",
            position: "right",
            backgroundColor: "#dc3545",
            stopOnFocus: true,
            style: {
                  color: "#ffffff", // Text color
                fontSize: "16px", // Optional: Adjust font size
                },
        }).showToast();
    }
}
      </script>

<script>
  
   async function toggleWishlist(productId) {
    try {
    const response = await fetch('/wishlist/toggle', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ productId }),
    });

    const result = await response.json();

    if (response.ok) {
      const wishlistIcon = document.querySelector(`.wishlist-icon[data-product-id="${productId}"] .iconsax`);
      
      if (result.action === 'added') {
        wishlistIcon.classList.add('text-danger');
        Toastify({
          text: 'Product added to wishlist!',
          duration: 3000,
          gravity: 'top',
          position: 'right',
          backgroundColor: 'linear-gradient(to right, #00b09b, #96c93d)',
          close: true,
        }).showToast();
      } else if (result.action === 'removed') {
        wishlistIcon.classList.remove('text-danger');
        Toastify({
          text: 'Product removed from wishlist!',
          duration: 3000,
          gravity: 'top',
          position: 'right',
          backgroundColor: 'linear-gradient(to right, #ff5f6d, #ffc371)',
          close: true,
        }).showToast();
      }
    } else {
      Toastify({
        text: result.error || 'Failed to update wishlist.',
        duration: 3000,
        gravity: 'top',
        position: 'right',
        backgroundColor: 'linear-gradient(to right, #ff5f6d, #ffc371)',
        close: true,
      }).showToast();
    }
  } catch (error) {
    console.error('Error:', error);
    Toastify({
      text: 'An error occurred. Please try again.',
      duration: 3000,
      gravity: 'top',
      position: 'right',
      backgroundColor: 'linear-gradient(to right, #ff5f6d, #ffc371)',
      close: true,
    }).showToast();
  }
}

// Remove from Wishlist
 

    </script>